<!DOCTYPE html>
<html lang="en">

<head>
    <title>Test</title>
    <link rel="stylesheet" href="/assets/upload.css" type="text/css">
    <link rel="stylesheet" href="/assets/navbar.css" type="text/css">
</head>

<body>
    <div class="topnav">
        <a class="active" href="/">Home</a>
        <a href="https://netdata.terano.dev">Netdata</a>
        <a href="https://data.terano.dev">ShareX Server</a>
        <a href="/pages/projects/">Projects</a>
        <a href="/pages/contact/">Contact</a>
        <a class="right" href="https://github.com/Million900o">Github</a>
    </div>

    <script>
        async function upload() {
            const fileField = document.querySelector('input[type="file"]');
            if (!fileField.files[0]) return errorMessage("No file was chosen.")

            let key = document.getElementById("key").value
            if (!key) return errorMessage("No key was given.")

            const formData = new FormData();
            formData.append('file', fileField.files[0]);

            let data = await fetch('/api/upload', {
                method: 'POST',
                body: formData,
                headers: {
                    'key': key
                }
            })

            let url = await data.text()

            if (isJson(url)) {
                errorMessage(JSON.parse(url).error)
            } else {
                goodMessage(url)
                copyToClipboard(url)
            }
        }

        function errorMessage(message) {
            let error = document.getElementById("error")
            error.textContent = message.toString()
            error.style.color = "red"
        }

        function goodMessage(message) {
            let error = document.getElementById("error")
            error.textContent = message.toString()
            error.onclick = copyToClipboard(error.innerText)
            error.style.color = "green"
        }

        function copyToClipboard(str) {
            const el = document.createElement('textarea');
            el.value = str;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        };

        function isJson(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }
    </script>

    <div class="title">
        <h2>Upload</h2>
    </div>

    <div class='filee'>
        <label for="file">File:</label>
        <input type="file" id="file" class="custom-file-input" />
    </div>

    <div>
        <label for="text">Key:</label>
        <input type="text" id="key" />
    </div>

    <div>
        <button onclick="upload()">Upload</button>
    </div>

    <a id="error" onclick="copyToClipboard(innerText)"></a>

</body>

</html>